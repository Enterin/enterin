/*
* 
* enterin.js
* Copyright (c) 2014 Gianfilippo Balestriero <info@enterinjs.com>
* 
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU Affero General Public License as
* published by the Free Software Foundation, either version 3 of the
* License, or (at your option) any later version.
* 
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU Affero General Public License for more details.
* 
* You should have received a copy of the GNU Affero General Public License
* along with this program.  If not, see <http://www.gnu.org/licenses/>.
* 
*/

var c=jQuery,d="Android;iPhone;iPad;iPod;BlackBerry;Windows Phone;webOS".split(";"),e=["enterin/core/style.enterin.css","enterin/libs/less/less.js"],f=["enterin/libs/mousewheel/jquery.mousewheel.js"];if("undefined"!=typeof $LIBS)for(var g in $LIBS)f.push($LIBS[g]);var k=[];if("undefined"!=typeof $CSS)for(g in $CSS)k.push($CSS[g]);var m={},n,p,q,r,s,t,u,v,w;function x(){n=!1;for(var a in d)if(navigator.userAgent.match(RegExp(d[a],"i"))){n=!0;break}}
function y(a){var b=c("<link>");b.d("rel","stylesheet/less");b.d("href",a);c("head").append(b)}function z(a){var b=c("<script>");b.d("src",a);c("head").append(b)}function A(){c('section[data-enterin="true"], div[data-enterin="true"]').f(function(){p=c(this);q=!0;r=1;var a=p.l(),b=a.find(".enterin-slide").length-1;p.text("");for(var h,l=0;l<b+1;l++)h=a.find(".enterin-slide").a(b-l),p.append(h);t=p.find(".enterin-slide");u=t.length;n||B();C();D();q=!1;E(1);n&&m.o.m()})}
function C(){c("body").find("[data-enterin-to]").click(function(a){var b=!1;a||(a=window.event);a.which?b=2==a.which:a.button&&(b=2==a.button);b||(r=c(this).data("enterin-to"),E(r),s&&F())})}
function B(){c("body").n(function(a){if(!(v&&300>a.timeStamp-v)){v=a.timeStamp;var b=a.keyCode||a.which;arrow={left:37,k:38,right:39,g:40};letters={h:71,z:90};switch(b){case arrow.left:a.preventDefault();r-=1;break;case arrow.right:a.preventDefault();r+=1;break;case arrow.k:a.preventDefault();r-=1;break;case arrow.g:a.preventDefault();r+=1;break;case letters.z:a.preventDefault();w?(c("body[data-enterin-zoom='true']").c("enterin-zoom"),w=!1):(c("body[data-enterin-zoom='true']").b("enterin-zoom"),w=
!0);break;case letters.h:a.preventDefault(),s?F():(p.b("show-grid"),E(1),n&&p.j("disable"),s=!0),a=s,console.log("%c[--- EnterIN Log -","color: #2980b9; font-weight:bold;"),console.log(a),console.log("%c- EnterIN Log ---]","color: #2980b9; font-weight:bold;")}1>r?r=u:r>u&&(r=1);E(r)}})}function D(){t.q("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd");t.a(r-1).p("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd",function(){q&&(q=!1)})}
function G(){t.f(function(a){var b=u-a-1,h=r-1;t.a(a).e("z-index",a);b==h&&t.a(a).e("z-index",2*u)})}function H(){p.i.c("enterin-active");p.i.a(u-r).b("enterin-active");t.a(r).focus()}function E(a){t.f(function(b){var h=b=1/u*(b+1)+1/u*(a-1),l="visible";1<h&&(h=0,l="hidden");c(this).e({transform:"scale("+b+")",opacity:h,visibility:l})});r=a;D();G();H()}H=function(){t.c("enterin-active");t.a(u-r).b("enterin-active")};function F(){s=!1;p.c("show-grid");n&&p.j("enable")}
(function(){var a=document.querySelector('script[rel="js/enterin"]').getAttribute("src"),a=a.replace(/\/enterin\/enterin\.js/,"")+"/";y(a+e[0]);z(a+e[1]);x();n&&(f.push("enterin/libs/touch-swipe/jquery.touchswipe.js"),f.push("enterin/mobile.enterin.js"));for(var b in k)y(a+k[b]);for(b in f)z(a+f[b]);window.onload=function(){A()}})();